---
title: "Amazon Bedrock AgentCore Workshop Guide"
inclusion: fileMatch
fileMatchPattern: 'prod_agent/*'
---

# Amazon Bedrock AgentCore Workshop Guide

This Guide is for a workshop on how to use Amazon Bedrock AgentCore. Users want to use Kiro to help take the agent code and deploy it to AgentCore and then invoke the Agent in a Streamlit App. It is important to do tasks that users can see the results right away. So, launch the agent instead of making lots of tests to verify the agent.

It is important to do steps that users can see actions right away

Task 1 - should be Configure
Task 2 - launch locally
Task 3 - launch to cloud
Task 4 - invoke agent in cloud
Task 5 - Streamlit app

Instead of making python scripts for agentcore functions, make bash scripts uses can run them. They are interactive so they will need user input anyway.

After MVP can investigate other tasks, but we need to get the users to see something and play with agent core right away!

After each task let the user do something such as launch the script or check the console to verify everything is working. We want them to be an active participant in the workshop.

This is a new service, and users need to see what it can do quickly so they understand how it works. Make sure to keep all the code inside the prod_agent/workshop_agent folder.

## Overview

Amazon Bedrock AgentCore is a comprehensive set of enterprise-grade services that help developers quickly and securely deploy and operate AI agents at scale using any framework and model. It eliminates tedious infrastructure work and operational complexity so development teams can bring groundbreaking agentic solutions to market faster.

## Key Components

### AgentCore Runtime
- Provides low-latency serverless environments with session isolation
- Supports any agent framework including popular open source frameworks like Strands Agents
- Handles multimodal workloads and long-running agents
- Offers secure deployment with proper IAM roles and permissions

### AgentCore Memory
- Manages session (short-term) and long-term memory
- Provides relevant context to models while helping agents learn from past interactions
- Supports memory extraction strategies like user preferences, summarization, and semantic memory
- Stores data encrypted using namespace-based storage for data segmentation

### AgentCore Identity
- Enables AI agents to securely access AWS services and third-party tools
- Supports multiple identity providers (Amazon Cognito, Okta, Microsoft Entra ID)
- Implements a secure token vault for storing user tokens
- Provides scoped permissions based on user or agent identity

### AgentCore Gateway
- Transforms existing APIs and AWS Lambda functions into agent-ready tools
- Offers unified access across protocols, including MCP
- Employs dual authentication for secure access control
- Facilitates cross-cutting features like authentication, authorization, and throttling

### AgentCore Tools
- **Browser**: Provides managed web browser instances for web automation workflows
- **Code Interpreter**: Offers isolated environments to run code generated by agents

## Deployment Workflow

1. **Configure**: Set up your agent with the AgentCore toolkit
   ```bash
   agentcore configure --entrypoint your_agent.py -er <IAM_ROLE_ARN>
   ```

2. **Test Locally**: Verify your agent works before cloud deployment
   ```bash
   agentcore launch -l
   agentcore invoke --local '{"prompt": "Your test prompt"}'
   ```

3. **Deploy to Cloud**: Launch your agent to Amazon Bedrock AgentCore
   ```bash
   agentcore launch
   ```

4. **Check Status**: Monitor deployment progress
   ```bash
   agentcore status
   ```

5. **Invoke**: Interact with your deployed agent
   ```bash
   agentcore invoke '{"prompt": "Your prompt"}'
   ```

## Best Practices

1. **Security**: Always use the principle of least privilege when configuring IAM roles
2. **Testing**: Thoroughly test your agent locally before deploying to the cloud
3. **Monitoring**: Use CloudWatch to monitor your agent's performance and errors
4. **Memory Management**: Configure appropriate memory strategies based on your use case
5. **Identity**: Implement proper identity controls for secure access to resources

## Code Example: Basic Agent with AgentCore Runtime

```python
from strands import Agent, tool
from bedrock_agentcore.runtime import BedrockAgentCoreApp

app = BedrockAgentCoreApp()

@tool
def my_tool(input: str):
    """Tool description"""
    return f"Processed: {input}"

agent = Agent(
    tools=[my_tool],
    system_prompt="You are a helpful assistant."
)

@app.entrypoint
def invoke(payload):
    """Handler for agent invocation"""
    user_message = payload.get("prompt", "No prompt provided")
    response = agent(user_message)
    return {"result": response.message}

if __name__ == "__main__":
    app.run()
```

## Programmatic Agent Invocation

While the AgentCore CLI provides a simple way to interact with your agent, you may want to integrate your agent into applications or scripts. Here's an example of how to invoke your agent programmatically using boto3:

```python
#!/usr/bin/env python3
"""
Script to invoke the CDK agent using boto3 directly.
This provides an alternative to using the agentcore CLI tool.
"""
import argparse
import boto3
import json
import sys
import os
import logging
import uuid

# Set up logging
logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')
logger = logging.getLogger(__name__)

def get_agent_runtime_arn(agent_name, region=None):
    """Get the ARN of the agent runtime by name.
    
    Args:
        agent_name (str): Name of the agent runtime
        region (str, optional): AWS region
        
    Returns:
        str: ARN of the agent runtime or None if not found
    """
    client = boto3.client('bedrock-agentcore-control', region_name=region)
    try:
        response = client.list_agent_runtimes()
        for runtime in response.get('agentRuntimeSummaries', []):
            if runtime['agentRuntimeName'] == agent_name:
                return runtime['agentRuntimeArn']
        
        # If we get here, the agent wasn't found
        logger.error(f"Agent runtime '{agent_name}' not found")
        return None
    except Exception as e:
        logger.error(f"Error getting agent runtime ARN: {e}")
        return None

def invoke_agent(agent_arn, prompt, session_id=None, region=None):
    """Invoke the agent with a prompt.
    
    Args:
        agent_arn (str): ARN of the agent runtime
        prompt (str): Prompt to send to the agent
        session_id (str, optional): Session ID for continuing conversations
        region (str, optional): AWS region
        
    Returns:
        dict: Response from the agent
    """
    client = boto3.client('bedrock-agentcore', region_name=region)
    
    # Create a session ID if not provided
    if not session_id:
        session_id = str(uuid.uuid4())
        logger.info(f"Created new session ID: {session_id}")
    
    # Prepare the payload
    payload = json.dumps({"prompt": prompt}).encode()
    
    try:
        # Invoke the agent
        logger.info(f"Invoking agent with prompt: {prompt}")
        response = client.invoke_agent_runtime(
            agentRuntimeArn=agent_arn,
            runtimeSessionId=session_id,
            payload=payload
        )
        
        # Parse and return the response
        response_body = json.loads(response['payload'].read().decode())
        return {
            'response': response_body,
            'session_id': session_id
        }
    except Exception as e:
        logger.error(f"Error invoking agent: {e}")
        return {
            'error': str(e),
            'session_id': session_id
        }

def main():
    """Main function to parse arguments and invoke the agent."""
    parser = argparse.ArgumentParser(description='Invoke CDK Agent')
    parser.add_argument('--agent-name', type=str, default='cdk-agent',
                        help='Name of the agent (default: cdk-agent)')
    parser.add_argument('--prompt', type=str, required=True,
                        help='Prompt to send to the agent')
    parser.add_argument('--session-id', type=str,
                        help='Session ID for continuing conversations')
    parser.add_argument('--region', type=str,
                        help='AWS region')
    parser.add_argument('--profile', type=str,
                        help='AWS profile to use')
    
    args = parser.parse_args()
    
    # Set AWS profile if provided
    if args.profile:
        os.environ['AWS_PROFILE'] = args.profile
    
    # Get the agent ARN
    agent_arn = get_agent_runtime_arn(args.agent_name, args.region)
    if not agent_arn:
        return 1
    
    # Invoke the agent
    result = invoke_agent(agent_arn, args.prompt, args.session_id, args.region)
    
    # Print the result
    print(json.dumps(result, indent=2))
    
    # Save the session ID for future use
    with open('last_session_id.txt', 'w') as f:
        f.write(result['session_id'])
    
    return 0

if __name__ == "__main__":
    sys.exit(main())
```

### Key Features of Programmatic Invocation

1. **Session Management**: Maintains conversation context across multiple invocations
2. **Error Handling**: Robust error handling and logging
3. **AWS Profile Support**: Ability to specify different AWS profiles
4. **Region Selection**: Flexibility to work across different AWS regions
5. **Command-line Interface**: Easy to use from scripts or terminals

### Integration Patterns

You can integrate your AgentCore agent into various application types:

1. **Web Applications**: Use the agent as a backend service for chatbots or assistants
2. **CLI Tools**: Create command-line tools that leverage your agent's capabilities
3. **Automation Scripts**: Incorporate your agent into automation workflows
4. **Mobile Apps**: Connect mobile applications to your agent via API calls
5. **Enterprise Systems**: Integrate with existing enterprise systems for enhanced capabilities


## Workshop Instructions

Users are using this guide for a workshop, these are the steps they would go through to test their agent. You can follow along with these instructions as well to make you can deploy agents to agent core.
### Step 1: Configure Your Agent

Configure your agent using the AgentCore toolkit with the IAM role you created in the previous exercise:

```bash
# Configure the agent with the IAM role ARN from the previous step
agentcore configure --entrypoint cdk_agent_core.py -er <YOUR_IAM_ROLE_ARN>
```

This will generate:
- A Dockerfile and .dockerignore file
- A .bedrock_agentcore.yaml configuration file

You can examine these generated files:

```bash
cat .bedrock_agentcore.yaml
cat Dockerfile
```

### Step 2: Test Your Agent Locally

Before deploying to the cloud, let's test your agent locally:

```bash
# Launch the agent locally
agentcore launch -l
```

This will:
- Build a Docker image with your agent code
- Run the container locally
- Start a server at http://localhost:8080

Once the local server is running, open a new terminal window and test the local agent:

```bash
# Invoke the local agent
agentcore invoke --local '{"prompt": "What are the best practices for AWS CDK?"}'
```

You should see a detailed response from the agent about AWS CDK best practices, sourced from the AWS documentation.

### Step 3: Deploy to Amazon Bedrock AgentCore

Once you've verified that your agent works locally, deploy it to Amazon Bedrock AgentCore:

```bash
# Deploy to AWS
agentcore launch
```

This deployment process will:
1. Build a Docker image with your agent code
2. Push the image to Amazon ECR
3. Create a Bedrock AgentCore runtime
4. Deploy your agent to the cloud

The deployment may take several minutes to complete.

### Step 4: Check Deployment Status

Check the status of your agent deployment:

```bash
# Check the status of your agent
agentcore status
```

The output will show details about your agent, including its current status. Wait until the status shows as "READY" before proceeding to the next exercise.

You can get more detailed information with:

```bash
agentcore status --verbose
```

## Exercise 4: Interact with Your Deployed Agent

Once your agent is deployed and in the "READY" state, you can interact with it using either the AgentCore CLI or the provided Python script.

### Method 1: Using the AgentCore CLI

The simplest way to interact with your agent is using the AgentCore CLI:

```bash
# Invoke your agent with a prompt about CDK constructs
agentcore invoke '{"prompt": "Explain AWS CDK constructs and their benefits"}'

# Ask about AWS pricing information
agentcore invoke '{"prompt": "What is the pricing for AWS Lambda in us-east-1?"}'

# Ask about AWS documentation
agentcore invoke '{"prompt": "How do I set up cross-region replication in S3?"}'
```

### Method 2: Using the Provided Python Script

The repository includes a Python script (`invoke_cdk_agent.py`) that provides a more programmatic way to interact with your agent. Let's examine it:

```bash
cat invoke_cdk_agent.py
```

This script:
- Uses boto3 to interact with the Bedrock AgentCore API
- Supports session management for conversational interactions
- Provides command-line arguments for flexibility
- Saves session IDs for continued conversations

Now, let's use the script to interact with your agent:

```bash
# Run the script with a prompt
python invoke_cdk_agent.py --prompt "What are the key features of AWS CDK?"
```

You can also continue a conversation by using the same session ID:

```bash
# Get the session ID from the previous run
SESSION_ID=$(cat last_session_id.txt)

# Continue the conversation
python invoke_cdk_agent.py --prompt "How does it compare to CloudFormation?" --session-id $SESSION_ID
```

### Try Different Types of Queries

Your agent can answer various types of questions about AWS services, CDK, and pricing. Try some of these examples:

```bash
# CDK-related query
agentcore invoke '{"prompt": "How do I create an S3 bucket with CDK?"}'

# Documentation query
agentcore invoke '{"prompt": "What are the different storage classes in S3?"}'

# Pricing query
agentcore invoke '{"prompt": "Compare the pricing of Lambda vs Fargate for a high-traffic application"}'
```



## Resources

- [AgentCore Documentation](https://docs.aws.amazon.com/bedrock-agentcore/)
- [AgentCore Samples GitHub Repo](https://github.com/awslabs/amazon-bedrock-agentcore-samples/)
- [Strands Agents Documentation](https://strandsagents.com/latest/)
- [Model Context Protocol (MCP) Specification](https://github.com/modelcontextprotocol/specification)